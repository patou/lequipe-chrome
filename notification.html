<!doctype html>
<html>
<head>
<title>L'quipe.fr Notification</title>
<script type="text/javascript" src="jquery-1.4.2.js"></script>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<style type="text/css">
a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

body {
	color: black;
	font-family: Arial, Helvetica, sans-serif;
    font-size: 12px;
}

h1 {
	font-family: Arial, Helvetica, sans-serif;
	text-align: center;
	text-transform: capitalize
}

h2 {
	font-style: italic
}

ul {
	list-style-type: circle
}

/* b { font-family: Arial, sans-serif; font-size: .9em }
span.nagios { font-family: Arial, sans-serif; font-size: .9em } */
b {
	font-size: .9em
}

span.nagios {
	font-size: .9em
}

span.lower {
	text-transform: lowercase
}

.footer {
	font-family: Arial, sans-serif;
	font-style: italic;
	font-size: .7em;
	text-align: right
}

#DIV_CONTENT img {
				
				margin : 5px;
			}
#DIV_CONTENT {
	height:80px; overflow:hidden;  margin:2px 4px 2px 4px
}

.titre {
	text-overflow: ellipsis;
	white-space: nowrap;
	height: 1.1em; 
	overflow: hidden;
	font-weight: bold;
	color: #2244BB;
	text-decoration: none;
}

#notif_nav {
	background-image: 	url(http://img.lequipe.fr/img_v5/icones_png.png?20100527);
background-position: 0px -623px;
background-repeat: no-repeat;
height: 15px;
padding-left: 10px;
padding-top: 1px;
margin-botom: 0px;
width: 98%;
}

#notif_nav a {
	color: #565151;
	float: left;
	font-size: 11px;
	font-weight: 700;
	margin-right: 24px;
}
#notif_retour {
	background-position: -166px -148px;
	cursor: pointer;
}

#notif_retour, #notif_suite, .notif_pt_rouge, .notif_pt_gris {
	background-image: url(http://www-ref.lequipe.fr/img_v5/icones_png.png?20100527);
	float: left;
	height: 15px;
	width: 15px;
}

.notif_pt_gris {
	background-position: -125px -148px;
}

.notif_pt_rouge {
	background-position: -125px -148px;
}

#notif_suite {
	background-position: -188px -148px;
	cursor: pointer;
}
</style>
<script type="text/javascript">

var listItems; 
var currentTabId = 0;

function afficheInfo(type)
{
	db = openDatabase("Equipe.fr", "1.0", "Items database", 200000);
            
            				function onError(tx, error) {
            				  console.log(error.message);
            				}
            				
            				// Selection des Items :
            				db.transaction(function(tx) {
            				    tx.executeSql("SELECT * FROM Items WHERE read = ? AND type = ?", [false, type], function(tx, result) {
								
								listItems = result.rows;
								
								for (var i = 0, item = null; i < result.rows.length; i++) {
								item = result.rows.item(i);
								
								if (i < 5) {
								
									$('#listeUnread').prepend('<div id="notif_nav_'+i+'" class="notif_pt_gris" onclick="afficheItem('+i+')"></div>');
								
								}
							}
								
								
            				     /* for (var i = 0, item = null; i < result.rows.length; i++) {
            				        item = result.rows.item(i);
									console.log(item['title']);
									
            				        
								  afficheItem(0);
            				      }*/
            				    });
							});
}

function afficheItem(item)
{
	html = '<div class="Notification"><a href="'+item['url']+'" target="_blank" class="titre">'+item['type']+' :'+item['title']+' </a>';
	html += '<div class="content">' + item['text'] + '</div>';
	html += ' </div>';
	
	
	
	
    $('#DIV_CONTENT').html(html);
	
	// Correction des images 
	$('img[src*=Medias]').attr('src', 'http://img.lequipe.fr' + $('img[src*=Medias]').attr('src') ).attr('height', 60).attr('width', 60);
	
	
	// lecture de l'item 
	chrome.extension.getBackgroundPage().setReadItem(item['id']);
}


function loadFooter(nav){
                        
                            var tabFooters = new Array();
                            
                            tabFooters["tous"] = "<a href=\"http://www.lequipe.fr\" target=\"_blank\">Plus d'infos >>></a>";
                            tabFooters["foot"] = "<a href=\"http://www.lequipe.fr/Football/index.html\" target=\"_blank\">Plus d'infos Football >>></a>";
                            tabFooters["auto"] = "<a href=\"http://www.lequipe.fr/Formule1/index.html\" target=\"_blank\">Plus d'infos Auto/Moto>>></a>";
                            tabFooters["tennis"] = "<a href=\"http://www.lequipe.fr/Tennis/index.html\" target=\"_blank\">Plus d'infos Tennis>>></a>";
                            tabFooters["rugby"] = "<a href=\"http://www.lequipe.fr/Rugby/index.html\" target=\"_blank\">Plus d'infos Rugby>>></a>";
                            tabFooters["bhv"] = "<a href=\"http://www.lequipe.fr/Basket/index.html\" target=\"_blank\">Plus d'infos Basket/Hand/Volley>>></a>";
                            tabFooters["cyclisme"] = "<a href=\"http://www.lequipe.fr/Cyclisme/index.html\" target=\"_blank\">Plus d'infos Cyclisme>>></a>";
                            tabFooters["autres"] = "<a href=\"http://www.lequipe.fr/Aussi/index.html\" target=\"_blank\">Plus d'infos Autres Sports>>></a>";
                            
                            $("#plusInfo").html(tabFooters[nav]);
                        }
						
						

function afficheNext()
{
	currentTabId += 1;
	var item = listItems.item(currentTabId);
	afficheItem(item);
}

function affichePrec()
{
	if (currentTabId != 0) currentTabId -= 1;
	var item = listItems.item(currentTabId);
	afficheItem(item);
}

function init () {
	console.log(window.location.search);
	var item = eval("a="+decodeURIComponent(window.location.search.substring(1)));
	afficheItem(item);
	loadFooter(item.type);
	afficheInfo(item.type);
}

$('#notif_retour').click(function () {
	afficheNext();
});

$('#notif_suite').click(function () {
	affichePrec();
});

</script>
</head>
<body onload="init();">
<div class='notification' id="DIV_CONTENT">
<div class="content">Nouvelle alerte !</div>
</div>
<div id="notif_nav">  
	<div id="plusInfo" ><a href="http://www.lequipe.fr" target="_blank">Plus d'infos >>></a></div>  
	<div id="notif_retour" onclick="affichePrec();"></div>  
	<div id="listeUnread" >
		
	</div>
<div id="notif_suite" onclick="afficheNext();"></div>
</div>

</body>
</html>